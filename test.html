<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>hushfile</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
        <link href="css/bootstrap-fileupload.min.css" rel="stylesheet" media="screen">
        <link href="css/bootstrapSwitch.css" rel="stylesheet" media="screen">
        <link href="css/font-awesome.min.css" rel="stylesheet" media="screen">
        <link href="css/progressbar.css" rel="stylesheet" media="screen">

    </head>
    
    <body style="padding: 80px 0 80px 0;">
        <input type="file" id="files" />
        <script src="js/jquery-1.9.1.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        <script src="js/bootbox.min.js"></script>
        <script src="js/bootstrapSwitch.js"></script>
        <script src="js/cryptojs-aes.js"></script>
        <script src="js/cryptojs-uint8.js"></script>
        <!--
        <script src="hushfile-common.js"></script>
        <script src="hushfile-upload.js"></script>
        <script src="hushfile-download.js"></script> -->
        <script src="hushfile.js"></script>
        <script src="cryptfile.js"></script>
        <script>
            $(document).ready(function() {
                // activate dismiss/close function of any bootstrap alert boxes
                $(".alert").alert();
                
                //var file = new File(b, 'foo.txt');

                /*hushfile.upload(file, function(fileid, password) {
                    console.log("yes! now lets download some shit" + fileid);
                    hushfile.download(fileid, password);
                },
                function() {
                });*/


                $('#files').change(function() {
                    var uploader = new HushFileUploader({
                        onloadstart: function() {
                            console.log("Started uploading");
                        },
                        onprogress: function(e) {
                            console.log("Uploaded:" + e.loaded + '/' + e.total);
                        },
                        onload: function(e) {
                            var downloader = new HushFileDownloader({
                                onloadstart: function() {
                                    console.log("Started downloading");
                                },
                                onprogress: function(e){ 
                                    console.log("Downloaded: " + e.loaded + '/' + e.total);
                                },
                                onload: function(e) {
                                    document.write("<a href='" + e.url + "'>wow</a>");
                                }
                            });
                            document.write('<button id="foobar">Download</button>');
                            $('#foobar').click(function() {

                                downloader.download(e.fileid, e.password);
                            });    
                        },
                        onerror: function(e) {
                            console.log("An error occured:" + e.message);
                        }
                    });
                    uploader.upload(this.files[0], function(fileid, password) {
                        
                    });
                });
            });
        </script>
    </body>
</html>
